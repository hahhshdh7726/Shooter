<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple 2D Battle Game</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #1e1e2f;
    color: white;
    font-family: monospace;
    user-select: none;
  }
  canvas {
    background: #2c2c44;
    display: block;
    margin: 0 auto;
    border: 2px solid #444;
  }
  #scoreboard {
    text-align: center;
    margin: 10px;
    font-size: 18px;
  }
</style>
</head>
<body>
<div id="scoreboard">Score: 0</div>
<canvas id="gameCanvas" width="600" height="400"></canvas>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreBoard = document.getElementById('scoreboard');

  const player = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    size: 20,
    color: '#00ff99',
    speed: 4,
    dx: 0,
    dy: 0,
  };

  const bullets = [];
  const enemies = [];
  const enemySize = 20;
  let score = 0;
  let keys = {};

  function spawnEnemy() {
    const edge = Math.floor(Math.random() * 4);
    let x, y;

    if(edge === 0) { // top
      x = Math.random() * canvas.width;
      y = -enemySize;
    } else if(edge === 1) { // right
      x = canvas.width + enemySize;
      y = Math.random() * canvas.height;
    } else if(edge === 2) { // bottom
      x = Math.random() * canvas.width;
      y = canvas.height + enemySize;
    } else { // left
      x = -enemySize;
      y = Math.random() * canvas.height;
    }

    enemies.push({
      x,
      y,
      size: enemySize,
      color: '#ff4444',
      speed: 1 + Math.random() * 1.5,
    });
  }

  function drawRect(obj) {
    ctx.fillStyle = obj.color;
    ctx.fillRect(obj.x - obj.size/2, obj.y - obj.size/2, obj.size, obj.size);
  }

  function updatePlayer() {
    player.x += player.dx;
    player.y += player.dy;

    // Boundaries
    if(player.x < player.size/2) player.x = player.size/2;
    if(player.x > canvas.width - player.size/2) player.x = canvas.width - player.size/2;
    if(player.y < player.size/2) player.y = player.size/2;
    if(player.y > canvas.height - player.size/2) player.y = canvas.height - player.size/2;
  }

  function updateBullets() {
    for(let i = bullets.length -1; i >= 0; i--) {
      const b = bullets[i];
      b.x += b.vx;
      b.y += b.vy;

      // Remove bullets out of canvas
      if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
        bullets.splice(i, 1);
      }
    }
  }

  function updateEnemies() {
    for(let i = enemies.length -1; i >= 0; i--) {
      const e = enemies[i];

      // Move enemy toward player
      const angle = Math.atan2(player.y - e.y, player.x - e.x);
      e.x += Math.cos(angle) * e.speed;
      e.y += Math.sin(angle) * e.speed;

      // Check collision with player
      if(distance(e.x, e.y, player.x, player.y) < (e.size + player.size) / 2) {
        alert('Game Over! Your score: ' + score);
        resetGame();
        return;
      }
    }
  }

  function checkBulletEnemyCollisions() {
    for(let i = enemies.length -1; i >= 0; i--) {
      for(let j = bullets.length -1; j >= 0; j--) {
        if(distance(enemies[i].x, enemies[i].y, bullets[j].x, bullets[j].y) < enemies[i].size / 2) {
          // Remove enemy and bullet
          enemies.splice(i, 1);
          bullets.splice(j, 1);
          score++;
          scoreBoard.textContent = 'Score: ' + score;
          break;
        }
      }
    }
  }

  function distance(x1, y1, x2, y2) {
    return Math.hypot(x2 - x1, y2 - y1);
  }

  function shoot() {
    if(keys[' ']) { // spacebar
      // Limit fire rate
      if(!player.canShoot) return;
      player.canShoot = false;
      setTimeout(() => player.canShoot = true, 300);

      // Bullet velocity based on last movement direction or default up
      let vx = 0, vy = -8;
      if(player.dx !== 0 || player.dy !== 0) {
        const mag = Math.hypot(player.dx, player.dy);
        vx = (player.dx / mag) * 8;
        vy = (player.dy / mag) * 8;
      }
      bullets.push({
        x: player.x,
        y: player.y,
        size: 6,
        color: '#ffff66',
        vx,
        vy,
      });
    }
  }

  function clear() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function draw() {
    clear();

    // Draw player
    drawRect(player);

    // Draw bullets
    bullets.forEach(drawRect);

    // Draw enemies
    enemies.forEach(drawRect);
  }

  function update() {
    updatePlayer();
    updateBullets();
    updateEnemies();
    checkBulletEnemyCollisions();
    shoot();
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  function resetGame() {
    enemies.length = 0;
    bullets.length = 0;
    score = 0;
    scoreBoard.textContent = 'Score: ' + score;
    player.x = canvas.width / 2;
    player.y = canvas.height / 2;
  }

  // Controls
  window.addEventListener('keydown', (e) => {
    keys[e.key.toLowerCase()] = true;

    if(keys['w'] || keys['arrowup']) player.dy = -player.speed;
    if(keys['s'] || keys['arrowdown']) player.dy = player.speed;
    if(keys['a'] || keys['arrowleft']) player.dx = -player.speed;
    if(keys['d'] || keys['arrowright']) player.dx = player.speed;

    // To handle diagonal movement correctly
    if((keys['w'] || keys['arrowup']) && (keys['s'] || keys['arrowdown'])) player.dy = 0;
    if((keys['a'] || keys['arrowleft']) && (keys['d'] || keys['arrowright'])) player.dx = 0;
  });

  window.addEventListener('keyup', (e) => {
    keys[e.key.toLowerCase()] = false;

    if(!keys['w'] && !keys['arrowup'] && !keys['s'] && !keys['arrowdown']) player.dy = 0;
    if(!keys['a'] && !keys['arrowleft'] && !keys['d'] && !keys['arrowright']) player.dx = 0;
  });

  player.canShoot = true;

  // Spawn enemies every 2 seconds
  setInterval(spawnEnemy, 2000);

  resetGame();
  gameLoop();
</script>
</body>
</html>
